version: 2

models:
  - name: dim_users
    description: |
      User dimension table with complete customer profile and lifetime metrics.
      Includes RFM scoring and behavioral segmentation.
    columns:
      - name: user_id
        description: Primary key - unique user identifier
        tests:
          - not_null
          - unique
      - name: user_segment
        description: Behavioral segment assigned at signup
        tests:
          - not_null
      - name: lifetime_revenue
        description: Total revenue generated by user
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: true
      - name: customer_value_tier
        description: Value tier based on lifetime revenue
        tests:
          - accepted_values:
              values: ['VIP', 'High Value', 'Medium Value', 'Low Value', 'No Purchase']
      - name: activity_status
        description: Current engagement status
        tests:
          - accepted_values:
              values: ['Active', 'Recent', 'Lapsing', 'Churned', 'Never Active']
      - name: buyer_status
        description: Purchase history classification
        tests:
          - accepted_values:
              values: ['Repeat Buyer', 'One-Time Buyer', 'Non-Buyer']

  - name: dim_products
    description: |
      Product dimension table with catalog data and performance metrics.
      Includes conversion rates and health indicators.
    columns:
      - name: product_id
        description: Primary key - unique product identifier
        tests:
          - not_null
          - unique
      - name: product_name
        description: Product display name
        tests:
          - not_null
      - name: category
        description: Product category
        tests:
          - not_null
      - name: price
        description: Product price in USD
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: overall_conversion_rate
        description: View-to-purchase conversion rate
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 1
              inclusive: true

  - name: dim_date
    description: |
      Date dimension table for time-based analysis.
      Includes calendar attributes and relative date flags.
    columns:
      - name: date_key
        description: Primary key - date value
        tests:
          - not_null
          - unique
      - name: year
        description: Calendar year
        tests:
          - not_null
      - name: month
        description: Calendar month (1-12)
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
              max_value: 12
              inclusive: true
      - name: day_of_week
        description: Day of week (0=Sunday, 6=Saturday)
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 6
              inclusive: true

  - name: fct_daily_engagement
    description: |
      Daily engagement fact table with KPIs.
      One row per date with user, session, and revenue metrics.
    columns:
      - name: event_date
        description: Primary key - date
        tests:
          - not_null
          - unique
      - name: daily_active_users
        description: Count of unique users active on this date
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: true
      - name: total_sessions
        description: Total sessions on this date
        tests:
          - not_null
      - name: total_revenue
        description: Total revenue generated
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: true
      - name: conversion_rate
        description: Session-to-purchase conversion rate
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 1
              inclusive: true

  - name: fct_funnel
    description: |
      Conversion funnel fact table with stage-by-stage metrics.
      Tracks user progression and drop-off rates.
    columns:
      - name: event_date
        description: Primary key - date
        tests:
          - not_null
          - unique
      - name: users_at_site
        description: Users who visited the site
        tests:
          - not_null
      - name: users_at_purchase
        description: Users who completed purchase
        tests:
          - not_null
      - name: overall_conversion_rate
        description: Site visitor to purchaser rate
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 1
              inclusive: true
      - name: cart_abandonment_rate
        description: Rate of cart abandonment
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 1
              inclusive: true

  - name: fct_revenue
    description: |
      Revenue fact table at date x category grain.
      Supports revenue analysis by dimension.
    columns:
      - name: event_date
        description: Date of transactions
        tests:
          - not_null
      - name: category
        description: Product category
        tests:
          - not_null
      - name: gross_revenue
        description: Total revenue for this date and category
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: true
      - name: transaction_count
        description: Number of transactions
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: true
